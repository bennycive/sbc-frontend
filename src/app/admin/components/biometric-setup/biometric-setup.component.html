<div class="container py-5 d-flex justify-content-center align-items-center bg-light min-vh-100">
  <div class="row w-100 justify-content-center">

    <!-- Fingerprint Card -->
    <div class="col-12 col-md-6 col-lg-5 mb-4 mb-md-0">
      <div class="card p-4 shadow-lg rounded-4 h-100 d-flex flex-column">
        <div class="finger-icon-wrapper mx-auto mb-3">
          <i class="bi bi-fingerprint display-1 text-primary" id="fingerIcon"></i>
        </div>

        <h4 class="fw-bold">Fingerprint Registration</h4>
        <p class="text-muted">Place your finger on the scanner or use your device's biometric authentication.</p>

        <button class="btn btn-primary w-100 mb-3" [disabled]="isScanning" (click)="captureFingerprint()">
          <span *ngIf="!isScanning">Scan Finger</span>
          <span *ngIf="isScanning">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Scanning...
          </span>
        </button>

        <div class="text-muted mb-2">Status: <strong>{{ fingerprintStatus }}</strong></div>

        <div *ngIf="fingerprintImage" class="mb-3">
          <img [src]="fingerprintImage" alt="Fingerprint" class="img-thumbnail shadow rounded" style="width: 120px;">
        </div>

        <!-- This button group is pushed to the bottom of the card -->
        <div class="mt-auto">
            <button class="btn btn-success w-100 mb-2" [disabled]="!fingerprintCaptured" (click)="submitBiometric()">Submit Fingerprint</button>
            <button class="btn btn-outline-secondary w-100" (click)="skipBiometric()">Skip for now</button>
        </div>
      </div>
    </div>

    <!-- Security Questions Card -->
    <div *ngIf="showSecurityQuestions" class="col-12 col-md-6 col-lg-5">
      <div class="card p-4 shadow-lg rounded-4 h-100 d-flex flex-column">
        <h4 class="fw-bold mb-3">Security Questions Setup</h4>
        <p class="text-muted">As a backup, please select and answer exactly 3 security questions.</p>

        <!-- Question Selection List with Checkboxes -->
        <div class="mb-3 text-start">
            <label class="form-label fw-bold">Choose 3 Questions:</label>
            <div *ngFor="let question of allQuestions" class="form-check">
                <input class="form-check-input" type="checkbox" [id]="question"
                       [checked]="isQuestionSelected(question)"
                       (change)="toggleQuestionSelection(question)">
                <label class="form-check-label" [for]="question">{{ question }}</label>
            </div>
        </div>

        <!-- Answer Inputs for Selected Questions -->
        <div *ngIf="selectedQuestions.length > 0" class="mb-3 text-start">
            <hr>
            <label class="form-label fw-bold">Provide Your Answers:</label>
            <!-- This ngFor iterates through the selected questions and creates an input for each -->
            <div *ngFor="let selectedQ of selectedQuestions; let i = index" class="mb-3">
                <label [for]="'answer' + i" class="form-label small">{{ selectedQ.question }}</label>
                <!-- [(ngModel)] now correctly binds to the 'answer' property of the object in the array -->
                <input type="text" [id]="'answer' + i" class="form-control" [(ngModel)]="selectedQ.answer" placeholder="Enter your answer">
            </div>
        </div>

        <!-- This button is pushed to the bottom and uses canSubmitAnswers() for its state -->
        <button class="btn btn-success w-100 mt-auto" [disabled]="!canSubmitAnswers()" (click)="submitAnswers()">Submit Answers</button>
      </div>
    </div>

  </div>
  
</div>
